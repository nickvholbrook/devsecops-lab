name: DevSecOps Pipeline
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
jobs:
  security-scan:
    name: Security & Vulnerability Scans
    runs-on: ubuntu-latest
steps:
      - name: Checkout Code
        uses: actions/checkout@v4
# Shift Left Security: Code Scanning with CodeQL
      - name: Initialize CodeQL
        uses: github/codeql-action/init@v2
        with:
          languages: javascript
- name: Perform CodeQL Analysis
        uses: github/codeql-action/analyze@v2
# Continuous Monitoring: Trivy Vulnerability Scan
      - name: Install Trivy
        run: |
          sudo apt-get install wget -y
          wget https://github.com/aquasecurity/trivy/releases/latest/download/trivy_Linux-64bit.tar.gz
          tar zxvf trivy_Linux-64bit.tar.gz
          sudo mv trivy /usr/local/bin/
- name: Run Trivy Scan
        run: trivy fs --no-progress --severity HIGH,CRITICAL .
        
  dependabot:
    name: Dependency Check
    runs-on: ubuntu-latest
steps:
      - name: Dependabot Metadata
        uses: dependabot/fetch-metadata@v1
        with:
          package-ecosystem: "npm"
          directory: "/"
          target-branch: "main"
